#ifndef UART_COMMAND_H_
#define UART_COMMAND_H_

#include "main.h"
#include "uart_log.h"

//#define D_UART   &huart2 //debug
#define C_UART   &huart6 //command
#define BL_RX_LEN  512

// Bootloader commands
#define BL_MEM_WRITE  0x57

/* ACK and NACK bytes */
#define BL_ACK   0XA5
#define BL_NACK  0X7F

/* CRC */
#define VERIFY_CRC_FAIL    1
#define VERIFY_CRC_SUCCESS 0

/* SECTOR */
#define VALID_SECTOR   1
#define INVALID_SECTOR 0

extern uint8_t bl_rx_buffer[BL_RX_LEN];
extern CRC_HandleTypeDef hcrc; // Thêm khai báo hcrc

void bootloader_uart_read_data(void);
void bootloader_jump_to_user_app(uint8_t bank);
void bootloader_handle_mem_write_cmd(uint8_t *pBuffer);
void bootloader_send_ack(uint8_t command_code, uint8_t follow_len);
void bootloader_send_nack(void);
uint8_t bootloader_verify_crc(uint8_t *pData, uint32_t len, uint32_t crc_host);
void bootloader_uart_write_data(uint8_t *pBuffer, uint32_t len);
uint8_t execute_mem_write(uint8_t *pBuffer, uint32_t mem_address, uint32_t len);
uint8_t execute_flash_erase(uint8_t sector_number, uint8_t number_of_sector);
#endif /* UART_COMMAND_H_ */
